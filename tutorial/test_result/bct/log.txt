2023-09-08 13:11:51,557 - root - INFO - 创建日志文件...
2023-09-08 13:11:51,594 - root - INFO - 创建 scDMLModel 对象完成...
2023-09-08 13:11:51,600 - root - INFO - 正在执行 preprocess() 函数...
2023-09-08 13:11:51,601 - root - INFO - 模式=unsupervised
2023-09-08 13:11:51,602 - root - INFO - 聚类方法=louvain
2023-09-08 13:11:51,604 - root - INFO - 分辨率=3.0
2023-09-08 13:11:51,605 - root - INFO - 批次键=BATCH
2023-09-08 13:11:51,606 - root - INFO - Normalize counts per cell(sum=10000.0)
2023-09-08 13:11:51,626 - root - INFO - Log1p data
2023-09-08 13:11:51,745 - root - INFO - Select HVG(n_top_genes=1000)
2023-09-08 13:11:52,001 - root - INFO - Scale batch(scale_value=10.0)
2023-09-08 13:11:52,185 - root - INFO - Calculate PCA(n_comps=100)
2023-09-08 13:11:57,110 - root - INFO - Apply louvain clustring(resolution=3.0) initization
2023-09-08 13:11:57,113 - root - INFO - Number of Cluster =23
2023-09-08 13:11:57,116 - root - INFO - clusters=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]
2023-09-08 13:11:57,122 - root - INFO - 预处理数据集完成。
2023-09-08 13:11:57,123 - root - INFO - mode=unsupervised
2023-09-08 13:11:57,151 - root - INFO - K_in=5, K_bw=10
2023-09-08 13:11:57,153 - root - INFO - 开始计算 KNN 和 MNN 以获取簇之间的相似性。
2023-09-08 13:11:57,154 - root - INFO - 使用近似方法计算每个批次内的 KNN 对...
2023-09-08 13:11:57,162 - root - INFO - Calculate KNN pair intra batch...........
2023-09-08 13:11:57,164 - root - INFO - K=5
2023-09-08 13:11:57,165 - root - INFO - metric=cosine
2023-09-08 13:11:57,166 - root - INFO - Processing datasets: (0, 0) = ('spk', 'spk')
2023-09-08 13:11:57,462 - root - INFO - There are (16720) KNN pairs when processing (0, 0)=('spk', 'spk')
2023-09-08 13:11:57,464 - root - INFO - Processing datasets: (1, 1) = ('vis', 'vis')
2023-09-08 13:11:57,767 - root - INFO - There are (16348) KNN pairs when processing (1, 1)=('vis', 'vis')
2023-09-08 13:11:57,768 - root - INFO - Processing datasets: (2, 2) = ('wal', 'wal')
2023-09-08 13:11:58,261 - root - INFO - There are (25048) KNN pairs when processing (2, 2)=('wal', 'wal')
2023-09-08 13:11:58,262 - root - INFO - scDML finds (58116) KNN pairs in dataset finally
2023-09-08 13:11:58,310 - root - INFO - 使用近似方法计算批次之间的 MNN 对...
2023-09-08 13:11:58,317 - root - INFO - Calculate MNN pair inter batch...........
2023-09-08 13:11:58,318 - root - INFO - K=10
2023-09-08 13:11:58,319 - root - INFO - metric=cosine
2023-09-08 13:11:58,320 - root - INFO - Processing datasets: (0, 1) = ('spk', 'vis')
2023-09-08 13:11:58,626 - root - INFO - There are (10942) MNN pairs when processing (0, 1)=('spk', 'vis')
2023-09-08 13:11:58,628 - root - INFO - Processing datasets: (0, 2) = ('spk', 'wal')
2023-09-08 13:11:59,036 - root - INFO - There are (15144) MNN pairs when processing (0, 2)=('spk', 'wal')
2023-09-08 13:11:59,037 - root - INFO - Processing datasets: (1, 2) = ('vis', 'wal')
2023-09-08 13:11:59,493 - root - INFO - There are (14438) MNN pairs when processing (1, 2)=('vis', 'wal')
2023-09-08 13:11:59,494 - root - INFO - scDML finds (40524) MNN pairs in dataset finally
2023-09-08 13:11:59,704 - root - INFO - 查找所有最近邻居完成。
2023-09-08 13:11:59,705 - root - INFO - 计算簇之间的相似性矩阵。
2023-09-08 13:11:59,805 - root - INFO - delete inner edge which link same cluster
2023-09-08 13:11:59,807 - root - INFO - 12694 knn pair in batch link different cluster
2023-09-08 13:11:59,891 - root - INFO - delete inner edge which link same cluster
2023-09-08 13:11:59,892 - root - INFO - 34150 mnn pair in batch link different cluster
2023-09-08 13:11:59,893 - root - INFO - ===================================================================================
2023-09-08 13:11:59,894 - root - INFO - NN pair ratio(number of MNN pairs/number of KNN pairs)=2.6902473609579327
2023-09-08 13:11:59,896 - root - INFO - ===================================================================================
2023-09-08 13:11:59,901 - root - INFO - 将相似性矩阵保存到文件中...
2023-09-08 13:11:59,907 - root - INFO - 将 nn 配对矩阵保存到文件中。
2023-09-08 13:11:59,960 - root - INFO - 完成相似性矩阵计算。
2023-09-08 13:11:59,977 - root - INFO - scDML merge cluster with rule2....
2023-09-08 13:11:59,985 - root - INFO - merge_rule2....
2023-09-08 13:12:00,263 - root - INFO - merging cluster set:[{1, 5, 6, 12, 15}, {0, 3, 4, 8, 9, 10, 11, 18, 20, 21}, {2, 7, 13, 14, 16, 17, 19, 22}]
2023-09-08 13:12:00,264 - root - INFO - 为scDML培训构建嵌入网络
2023-09-08 13:12:00,271 - root - INFO - EmbeddingNet(
  (actn): ReLU()
  (fc): Sequential(
    (0): Linear(in_features=1007, out_features=256, bias=True)
    (1): ReLU()
    (2): Linear(in_features=256, out_features=32, bias=True)
  )
)
2023-09-08 13:12:00,273 - root - INFO - 构建嵌入网络完成…
2023-09-08 13:12:00,275 - root - INFO - train scDML(expect_num_cluster=3) with Embedding Net
2023-09-08 13:12:00,276 - root - INFO - expect_num_cluster=3
2023-09-08 13:12:00,278 - root - INFO - 利用CPU训练模型
2023-09-08 13:12:00,281 - root - INFO - use euclidean distance and hard triplet to train model
2023-09-08 13:12:00,283 - root - INFO - not use earlystopping!!!!
2023-09-08 13:12:01,639 - root - INFO - epoch=1,number_hard_triplet=39906,loss=3374.792724609375
2023-09-08 13:12:02,690 - root - INFO - epoch=2,number_hard_triplet=5774,loss=4232.44189453125
2023-09-08 13:12:03,675 - root - INFO - epoch=3,number_hard_triplet=1976,loss=2264.72314453125
2023-09-08 13:12:04,658 - root - INFO - epoch=4,number_hard_triplet=934,loss=1809.0357666015625
2023-09-08 13:12:05,642 - root - INFO - epoch=5,number_hard_triplet=713,loss=2237.9013671875
2023-09-08 13:12:06,592 - root - INFO - epoch=6,number_hard_triplet=347,loss=2167.219482421875
2023-09-08 13:12:07,560 - root - INFO - epoch=7,number_hard_triplet=556,loss=2488.430908203125
2023-09-08 13:12:08,565 - root - INFO - epoch=8,number_hard_triplet=353,loss=3088.9111328125
2023-09-08 13:12:09,521 - root - INFO - epoch=9,number_hard_triplet=28,loss=529.06396484375
2023-09-08 13:12:10,523 - root - INFO - epoch=10,number_hard_triplet=67,loss=1669.102783203125
2023-09-08 13:12:11,415 - root - INFO - epoch=11,number_hard_triplet=550,loss=3097.51123046875
2023-09-08 13:12:12,300 - root - INFO - epoch=12,number_hard_triplet=90,loss=1230.437744140625
2023-09-08 13:12:13,421 - root - INFO - epoch=13,number_hard_triplet=55,loss=2019.2421875
2023-09-08 13:12:14,317 - root - INFO - epoch=14,number_hard_triplet=35,loss=1089.0345458984375
2023-09-08 13:12:15,221 - root - INFO - epoch=15,number_hard_triplet=13,loss=665.357421875
2023-09-08 13:12:16,118 - root - INFO - epoch=16,number_hard_triplet=96,loss=1103.375244140625
2023-09-08 13:12:17,000 - root - INFO - epoch=17,number_hard_triplet=47,loss=1753.3861083984375
2023-09-08 13:12:17,884 - root - INFO - epoch=18,number_hard_triplet=192,loss=1777.6297607421875
2023-09-08 13:12:18,769 - root - INFO - epoch=19,number_hard_triplet=9,loss=1091.174072265625
2023-09-08 13:12:19,659 - root - INFO - epoch=20,number_hard_triplet=17,loss=1555.9117431640625
2023-09-08 13:12:20,550 - root - INFO - epoch=21,number_hard_triplet=63,loss=2127.021728515625
2023-09-08 13:12:21,426 - root - INFO - epoch=22,number_hard_triplet=7,loss=297.63336181640625
2023-09-08 13:12:22,319 - root - INFO - epoch=23,number_hard_triplet=40,loss=2059.978515625
2023-09-08 13:12:23,215 - root - INFO - epoch=24,number_hard_triplet=18,loss=1586.4949951171875
2023-09-08 13:12:24,101 - root - INFO - epoch=25,number_hard_triplet=25,loss=764.4714965820312
2023-09-08 13:12:24,990 - root - INFO - epoch=26,number_hard_triplet=1,loss=369.6341857910156
2023-09-08 13:12:25,868 - root - INFO - epoch=27,number_hard_triplet=0,loss=0.0
2023-09-08 13:12:26,763 - root - INFO - epoch=28,number_hard_triplet=0,loss=0.0
2023-09-08 13:12:27,621 - root - INFO - epoch=29,number_hard_triplet=0,loss=0.0
2023-09-08 13:12:28,506 - root - INFO - epoch=30,number_hard_triplet=21,loss=667.6241455078125
2023-09-08 13:12:29,392 - root - INFO - epoch=31,number_hard_triplet=7,loss=1248.6390380859375
2023-09-08 13:12:30,297 - root - INFO - epoch=32,number_hard_triplet=65,loss=1987.369384765625
2023-09-08 13:12:31,176 - root - INFO - epoch=33,number_hard_triplet=15,loss=2487.14599609375
2023-09-08 13:12:32,077 - root - INFO - epoch=34,number_hard_triplet=69,loss=1996.5743408203125
2023-09-08 13:12:32,955 - root - INFO - epoch=35,number_hard_triplet=41,loss=1767.3818359375
2023-09-08 13:12:33,841 - root - INFO - epoch=36,number_hard_triplet=51,loss=2774.539306640625
2023-09-08 13:12:34,710 - root - INFO - epoch=37,number_hard_triplet=28,loss=1142.5853271484375
2023-09-08 13:12:35,597 - root - INFO - epoch=38,number_hard_triplet=6,loss=2140.85546875
2023-09-08 13:12:36,516 - root - INFO - epoch=39,number_hard_triplet=52,loss=3419.5361328125
2023-09-08 13:12:37,402 - root - INFO - epoch=40,number_hard_triplet=0,loss=0.0
2023-09-08 13:12:38,293 - root - INFO - epoch=41,number_hard_triplet=0,loss=0.0
2023-09-08 13:12:39,183 - root - INFO - epoch=42,number_hard_triplet=11,loss=834.52734375
2023-09-08 13:12:40,105 - root - INFO - epoch=43,number_hard_triplet=19,loss=1788.7547607421875
2023-09-08 13:12:40,986 - root - INFO - epoch=44,number_hard_triplet=3,loss=798.21875
2023-09-08 13:12:41,879 - root - INFO - epoch=45,number_hard_triplet=61,loss=2943.51171875
2023-09-08 13:12:42,775 - root - INFO - epoch=46,number_hard_triplet=46,loss=2520.134521484375
2023-09-08 13:12:43,652 - root - INFO - epoch=47,number_hard_triplet=4,loss=618.0127563476562
2023-09-08 13:12:44,582 - root - INFO - epoch=48,number_hard_triplet=9,loss=775.3303833007812
2023-09-08 13:12:45,513 - root - INFO - epoch=49,number_hard_triplet=6,loss=874.1712646484375
2023-09-08 13:12:46,382 - root - INFO - epoch=50,number_hard_triplet=1,loss=249.8271942138672
2023-09-08 13:12:46,383 - root - INFO - scDML training done....
2023-09-08 13:12:46,384 - root - INFO - extract embedding for dataset with trained network
2023-09-08 13:13:03,598 - matplotlib.legend - WARNING - No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
